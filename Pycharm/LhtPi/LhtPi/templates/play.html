<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>SlidePi Wiedergabe</title>
    <style>
        body {
            background-color: black;
            margin: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        #media-container {
            max-width: 100vw;
            max-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #controls {
            position: fixed;
            bottom: 20px;
            display: flex;
            gap: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 18px;
            border: none;
            border-radius: 5px;
            background-color: #8e44ad;
            color: white;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="media-container">
        <img id="media" src="" alt="Media" style="max-height: 100vh; max-width: 100vw; display: none;">
        <video id="video" controls autoplay style="max-height: 100vh; max-width: 100vw; display: none;"></video>
    </div>

    <div id="controls">
        <button onclick="prev()">⏮️ Zurück</button>
        <button onclick="togglePause()" id="pauseBtn">⏸️ Pause</button>
        <button onclick="next()">⏭️ Weiter</button>
    </div>

    <script>
        let playlist = [];
        let durations = {};
        let current = 0;
        let playing = true;
        let timeoutId = null;

        const img = document.getElementById('media');
        const video = document.getElementById('video');
        const pauseBtn = document.getElementById('pauseBtn');

        async function loadPlaylist() {
            const res = await fetch('/playlist.json');
            playlist = await res.json();

            const dur = await fetch('/durations.json');
            durations = await dur.json();

            showItem(current);
        }

        function showItem(index) {
            clearTimeout(timeoutId);
            if (index < 0 || index >= playlist.length) return;

            const filename = playlist[index].filename || playlist[index];
            const ext = filename.split('.').pop().toLowerCase();
            const duration = durations[filename] || 10;
            const src = `/media/${filename}`;

            if (ext === 'mp4') {
                img.style.display = 'none';
                video.style.display = 'block';
                video.src = src;
                video.play();
            } else {
                video.style.display = 'none';
                video.pause();
                img.style.display = 'block';
                img.src = src;
            }

            // Nächster Wechsel nur bei Bildern (Videos haben eigene Steuerung)
            if (ext !== 'mp4') {
                timeoutId = setTimeout(() => {
                    next();
                }, duration * 1000);
            }
        }

        function next() {
            current = (current + 1) % playlist.length;
            showItem(current);
        }

        function prev() {
            current = (current - 1 + playlist.length) % playlist.length;
            showItem(current);
        }

        function togglePause() {
            if (playlist.length === 0) return;
            const filename = playlist[current].filename || playlist[current];
            const ext = filename.split('.').pop().toLowerCase();

            if (ext === 'mp4') {
                if (video.paused) {
                    video.play();
                    pauseBtn.innerText = "⏸️ Pause";
                } else {
                    video.pause();
                    pauseBtn.innerText = "▶️ Fortsetzen";
                }
            } else {
                if (playing) {
                    clearTimeout(timeoutId);
                    pauseBtn.innerText = "▶️ Fortsetzen";
                } else {
                    timeoutId = setTimeout(() => {
                        next();
                    }, (durations[filename] || 10) * 1000);
                    pauseBtn.innerText = "⏸️ Pause";
                }
                playing = !playing;
            }
        }

        loadPlaylist();
    </script>
</body>
</html>
